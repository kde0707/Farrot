<!doctype html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <title>Bigshop | Responsive E-commerce Template</title>
    <link rel="icon" href="/img/core-img/favicon.ico">
    <link rel="stylesheet" href="/style.css">
    <style>
        #report-modal .form-label {
            font-weight: bold;
        }

        #report-modal .form-select,
        #report-modal .form-control {
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
        }

        #report-modal .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        #report-modal .btn-danger:hover {
            background-color: #c82333;
        }

        #report-modal .btn-close {
            border: 2px solid black;
            border-radius: 5px;
            color: white;
            background-color: transparent;
            font-size: 1.5rem;
            padding: 5px 10px;
            text-shadow: 2px 2px 0 black;
            transition: background-color 0.3s, color 0.3s;
        }

        #report-modal .btn-close:hover {
            background-color: black;
            color: white;
        }


        .single_product_desc {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .product-title {
            font-size: 1.8rem;
            color: #007bff;
            font-weight: bold;
        }

        .seller-info, .category-info, .price-info, .status-info, .created-at-info, .view-info {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .short_overview h6 {
            font-size: 1rem;
            color: #555;
            margin-bottom: 10px;
        }

        .short_overview p {
            font-size: 0.9rem;
            color: #666;
        }

        .price-info span {
            font-size: 1.1rem;
            font-weight: bold;
            color: #28a745;
        }

        .status-info span {
            font-size: 0.9rem;
            padding: 0.2rem 0.5rem;
        }

        .btn-sm {
            padding: 0px 10px;
            font-size: 0.9rem;
            border-radius: 4px;
        }

        .btn {
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #0056b3;
        }


    </style>
</head>

<body>
<div th:replace="/layout/header :: header"></div>
<div class="modal fade" id="quickview" tabindex="-1" role="dialog" aria-labelledby="quickview" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <button type="button" class="close btn" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <div class="modal-body">
                <div class="quickview_body">
                    <div class="container">
                        <div class="row">
                            <div class="col-12 col-lg-5">
                                <div class="quickview_pro_img">
                                    <img class="first_img" src="/img/product-img/new-1-back.png" alt="">
                                    <img class="hover_img" src="/img/product-img/new-1.png" alt="">
                                </div>
                            </div>
                            <div class="col-12 col-lg-7">
                                <div class="quickview_pro_des">
                                    <h4 class="title">Boutique Silk Dress</h4>
                                    <div class="top_seller_product_rating mb-15">
                                        <i class="fa fa-star" aria-hidden="true"></i>
                                        <i class="fa fa-star" aria-hidden="true"></i>
                                        <i class="fa fa-star" aria-hidden="true"></i>
                                        <i class="fa fa-star" aria-hidden="true"></i>
                                        <i class="fa fa-star" aria-hidden="true"></i>
                                    </div>
                                    <h5 class="price">$120.99 <span>$130</span></h5>
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Mollitia expedita
                                        quibusdam aspernatur, sapiente consectetur accusantium perspiciatis praesentium
                                        eligendi, in fugiat?</p>
                                    <a href="#">View Full Product Details</a>
                                </div>
                                <form class="cart" method="post">
                                    <div class="quantity">
                                        <input type="number" class="qty-text" id="qty" step="1" min="1" max="12"
                                               name="quantity" value="1">
                                    </div>
                                    <button type="submit" name="addtocart" value="5" class="cart-submit">Add to cart
                                    </button>
                                    <div class="modal_pro_wishlist">
                                        <a href="/wishlist.html"><i class="icofont-heart"></i></a>
                                    </div>
                                    <div class="modal_pro_compare">
                                        <a href="/compare.html"><i class="icofont-exchange"></i></a>
                                    </div>
                                </form>
                                <div class="share_wf mt-30">
                                    <p>Share with friends</p>
                                    <div class="_icon">
                                        <a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                                        <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                                        <a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a>
                                        <a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
                                        <a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a>
                                        <a href="#"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="breadcumb_area">
    <div class="container h-100">
        <div class="row h-100 align-items-center">
            <div class="col-12">
                <h5>상품 상세</h5>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/index.html">Home</a></li>
                    <li class="breadcrumb-item active">Product Details</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<!-- Breadcumb Area -->

<!-- Single Product Details Area -->
<section class="single_product_details_area section_padding_100">
    <div class="container">
        <div class="row">
            <div class="col-12 col-lg-6">
                <div class="single_product_thumb">
                    <div id="product_details_slider" class="carousel slide" data-ride="carousel">

                        <!-- 이미지영역 -->
                        <div class="carousel-inner">
                            <div class="carousel-item active single-product-area">
                                <div class="product_image">
                                    <a class="gallery_img" th:href="@{${productDetail.images.get(0).getPath()}}"
                                       title="First Slide" style="position: relative;">
                                        <img class="d-block w-100" th:src="@{${productDetail.images.get(0).getPath()}}"
                                             alt="First slide">
                                        <div class="overlay" th:if="${productDetail.productStatus.equals('예약중')}"
                                             style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.3); color: white; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; font-weight: bold;">
                                            예약중
                                        </div>
                                        <div class="overlay" th:if="${productDetail.productStatus.equals('판매완료')}"
                                             style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.3); color: green; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; font-weight: bold;">
                                            판매완료
                                        </div>
                                        <div class="wish-check product_wish_badge">
                                            <span th:if="${wishResponse.wishType}=='WISH'" class="badge-new"><i
                                                    class="icofont-heart"></i></span>
                                        </div>

                                        <div id="wish" class="product_wishlist">
                                            <a href="#"><i class="icofont-heart"></i></a>
                                        </div>
                                        <input type="hidden" id="wish-type" th:value="${wishResponse.wishType}">
                                        <script th:inline="javascript">
                                            const wish = document.getElementById('wish');
                                            const wishType = document.getElementById('wish-type');
                                            const wishCheck = document.querySelector('.wish-check')
                                            wish.addEventListener('click', () => {
                                                console.log('위쉬리스트 클릭')
                                                console.log(wishType.value)
                                                $.ajax({
                                                    url: '/wishlist/wish',
                                                    contentType: 'application/json',
                                                    type: 'post',
                                                    data:
                                                        JSON.stringify({
                                                            productId: [[${productDetail.productId}]],
                                                            wishType: wishType.value
                                                        }),
                                                    success: data => {
                                                        console.log('성공')
                                                        console.log(data)
                                                        if (data.wishType === 'WISH') {
                                                            wishType.value = 'WISH'
                                                            wishCheck.innerHTML = '<span class="badge-new"><i class="icofont-heart"></i></span>';
                                                        } else {
                                                            wishType.value = 'CANCEL'
                                                            wishCheck.innerHTML = '';
                                                        }
                                                    },
                                                    error: data => {
                                                        console.log('에러', JSON.parse(data.responseText).message)
                                                    }
                                                })
                                            })
                                        </script>
                                    </a>
                                </div>
                            </div>
                            <div th:each="image, iterStat : ${productDetail.images}">
                                <div class="carousel-item" th:if="${iterStat.index > 0}">
                                    <a class="gallery_img" th:href="@{${image.getPath()}}" title="Slide">
                                        <img class="d-block w-100" th:src="@{${image.getPath()}}" alt="Slide">
                                    </a>
                                </div>
                            </div>

                        </div>

                        <!-- 작은 이미지 영역 -->
                        <ol class="carousel-indicators">
                            <li class="active" data-target="#product_details_slider" data-slide-to="0"
                                th:style="'background-image: url(' + @{${productDetail.images.get(0).getPath()}} + ');'">
                            </li>

                            <li th:each="image, iterStat : ${productDetail.images}"
                                th:if="${iterStat.index > 0 && iterStat.index <= 3}"
                                data-target="#product_details_slider" th:data-slide-to="${iterStat.index}"
                                th:style="'background-image: url(' + @{${image.getPath()}} + ');'">
                            </li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-6">
                <div class="single_product_desc card p-4 shadow-sm">
                    <h1 th:text="${productDetail.productName}" class="product-title mb-3 text-primary font-weight-bold">
                        상품명</h1>

                    <p class="seller-info mb-2">
                        <strong>판매자:</strong>
                        <span th:text="${productDetail.sellerName}" class="text-muted">판매자명</span>
                    </p>

                    <p class="category-info mb-2">
                        <strong>카테고리:</strong>
                        <span th:text="${productDetail.categoryName}" class="text-muted">카테고리</span>
                    </p>

                    <div class="short_overview mb-4">
                        <h6 class="font-weight-bold">상품 설명</h6>
                        <p th:text="${productDetail.description}" class="text-muted"></p>
                    </div>

                    <p class="price-info mb-2">
                        <strong>가격:</strong>
                        <span th:text="${productDetail.price} + ' 원'" class="text-success">가격</span>
                    </p>

                    <p class="status-info mb-2">
                        <strong>상태:</strong>
                        <span th:text="${productDetail.productStatus}" class="badge badge-info">판매중</span>
                    </p>

                    <p class="created-at-info mb-2">
                        <strong>등록시간:</strong>
                        <span th:text="${productDetail.createdAt}" class="text-muted">등록시간</span>
                    </p>

                    <p class="view-info mb-2">
                        <strong>조회수:</strong>
                        <span th:text="${productDetail.view}" class="text-muted">조회수</span>
                    </p>

                    <div class="d-flex flex-wrap justify-content-start align-items-center mt-4">
                        <form class="cart clearfix d-flex align-items-center"
                              th:action="@{/chat-room/enter/{id}(id=${productDetail.productId})}" method="POST">
                            <button type="submit" value="5" class="btn btn-secondary btn-sm mx-1">채팅하기</button>
                        </form>

                        <form th:action="@{/payment/init-payment}" method="post" onsubmit="return validateStatus()">
                            <input type="hidden" name="productId" th:value="${productDetail.productId}"/>
                            <input type="hidden" name="amount" th:value="${productDetail.price}"/>
                            <button type="submit" class="btn btn-success btn-sm mx-1">안전거래</button>
                        </form>

                        <form th:action="@{/report}" method="post">
                            <button class="btn btn-danger btn-sm mx-1" type="button" data-bs-toggle="modal"
                                    data-bs-target="#report">
                                신고하기
                            </button>

                            <div class="modal fade" id="report" tabindex="-1" aria-labelledby="exampleModalLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content" id="report-modal">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="exampleModalLabel">신고하기</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">ㅡ
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <input type="hidden" name="productId" th:value="${productDetail.productId}" />

                                            <label for="reportType" class="form-label">신고 유형</label>
                                            <div class="mb-3">
                                                <select class="form-select" id="reportType" name="reportType" required>
                                                    <option selected disabled>유형 선택...</option>
                                                    <option value="SCAM">가격 사기</option>
                                                    <option value="INSUFFICIENT_DESCRIPTION">상품 설명 미비</option>
                                                    <option value="DUPLICATE_POST">중복 게시물</option>
                                                    <option value="OTHER">기타</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                ㅤ
                                            </div>
                                            <div class="mb-3">
                                                <label for="content" class="form-label">신고 내용</label>
                                                <textarea class="form-control" name="content" id="content" rows="4" required></textarea>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                                            <button type="submit" class="btn btn-danger">신고</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="you_may_like_area section_padding_0_100 clearfix">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="section_heading new_arrivals">
                    <h5>추천 상품</h5>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="you_make_like_slider owl-carousel">
                    <div class="single-product-area" th:each="product : ${response.productPage}">
                        <div class="product_image">
                            <img class="normal_img" th:src="${response.productImages[product.id].get(0).getPath()}"
                                 alt="상품 이미지" style="width: 300px; height: 300px;">
                        </div>
                        <div class="product_description">
                            <div class="product_add_to_cart">
                                <form id="enterChatRoom" th:method="POST"
                                      th:action="@{/chat-room/enter/{id}(id=${product.id})}">
                                </form>
                                <a href="#" onclick="enterChatRoom()"><i class="icofont-shopping-cart"></i> 채팅하기</a>
                            </div>
                            <div class="product_quick_view">
                                <a th:href="@{/product/product-detail(productId=${product.id})}">
                                    <i class="fa fa-reply"></i> 보러 가기
                                </a>
                            </div>
                            <p class="brand_name" th:text="${product.category.code}">카테고리명</p>
                            <a th:href="@{/product/product-detail(productId=${product.id})}"
                               th:text="${product.productName}">상품명</a>
                            <h6 class="product-price" th:text="'₩' + ${product.price}">가격</h6>
                            <div>
                                <i class="icofont-eye-alt"></i>
                                <span th:text="${product.view}"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    function validateStatus() {
        const productStatus = '[[${productDetail.productStatus}]]'
        if (productStatus === '예약중') {
            alert('예약중인 상품입니다.');
            return false;
        } else if (productStatus === '판매완료') {
            alert('판매완료된 상품입니다.');
            return false;
        }
        return true;
    }

    window.onload = function() {
        const errorMessage = '[[${errorMessage}]]';
        const successMessage = '[[${successMessage}]]';

        if (errorMessage) {
            alert(errorMessage);
        }

        if (successMessage) {
            alert(successMessage);
        }
    };

</script>
<div th:replace="/layout/footer :: footer"></div>
</body>

</html>